machine:
  timezone: America/Los_Angeles

  ruby:
    version:
      2.5.1

general:
  branches:
    ignore:
      - gh-pages
      - gcloud-jsondoc
      - gcloud-rdoc
      - yard-gcloud

dependencies:
  cache_directories:
    - "/opt/circleci/.rvm"

  pre:
    - rvm get stable
    - rvm-exec 2.5.1 gem update --system
    - rvm-exec 2.4.4 gem update --system
    - rvm-exec 2.3.7 gem update --system

test:
  override:
    - ruby build/test.rb:
        parallel: true

  post:
    - ruby build/post_test.rb:
        parallel: true

deployment:
  release:
    tag: /(\S*)\/v(\S*)/
    owner: GoogleCloudPlatform
    commands:
      - rvm-exec 2.5.1 bundle exec rake circleci:release

notify:
  webhooks:
    - url: https://coveralls.io/webhook?repo_token=VdG8EataF3PrWBZOBH7Hr80BXUjYRLh7o
